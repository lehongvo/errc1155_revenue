1. Xác định lỗi:
- Đây không phải lỗi vì không nằm trong requirement ban đầu
- Requirement chỉ yêu cầu:
+ Token holders có thể rút revenue theo tỉ lệ token sở hữu
+ Đảm bảo rút đúng số tiền theo tỉ lệ sở hữu
- Không có yêu cầu về cơ chế rút (1 lần/nhiều lần)

2. Nguyên nhân:
- Code hiện tại đang mặc định ai sử hữu token có thể rút được revenue
* xample: withdraw_revenue
lần 1:
- total_revenue = 100 SUI - share = (100 * 10%) = 10 SUI
- A rút được 10 SUI withdraw_revenue
lần 2:
- total_revenue vẫn = 100 SUI - share = (100 * 10%) = 10 SUI
- A lại rút được 10 SUI nữa!

3. Tình tiết giảm nhẹ:
- System vẫn hoạt động đúng về mặt tỉ lệ chia revenue
- Có event logs để track mọi transaction
- Admin có thể:
+ Deposit từng phần nhỏ thay vì một lần lớn
+ Monitor và phát hiện bất thường qua events
+ Có thể cập nhật contract nếu cần thiết

4. Solution trực tiếp cho cái này là gì
- Làm rõ cơ chế
+ Theo dõi số tiền đã rút cho mỗi NFT/token
+ Chưa Ngăn chặn rút nhiều lần cùng một khoản revenue
- Xác định cách tính revenue share

5. Các vấn đề liên quan cần check:
- Review toàn bộ flow liên quan đến tiền
- Check các function có tính chất tương tự (deposit, transfer)
- Review lại requirement của các chức năng khác
- Test các edge case về quyền sở hữu và revenue

6. Bài học rút ra:
- Requirement phase:
-Xác nhận lại với client về cách hoạt động mong muốn
+ Liệt kê chi tiết các case cần xử lý
+ Document rõ ràng các giả

7. Phòng tránh:
- Test case đầy đủ
- Document chi tiết
- Monitor chặt chẽ
- Update contract khi cần
